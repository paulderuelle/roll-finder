<div class="profile-global-container">
  <div class="col-md 12">
    <div class="profile-display">
      <% if current_user %>
        <div class="profile-btn-container">
          <div class="btn-profile btn-edit">
            <%= link_to destroy_user_session_path, data: { turbo_method: :delete } do %>
              <% concat content_tag(:i, "", class: "fa-solid fa-power-off fa-lg") %>
            <% end %>
          </div>
          <div class="btn-profile btn-logout">
            <%= link_to edit_user_path(current_user), class: "edit" do %>
              <% concat content_tag(:i, "", class: "fa-solid fa-pencil fa-lg") %>
            <% end %>
          </div>
        </div>
      <% end %>

      <div class="profile-details">
        <p><%= @user.nickname %></p>
        <p><%= @user.first_name %></p>
        <% if @reviews.present? %>
          <p>Average Rating: <%= number_with_precision(@reviews.average(:rating), precision: 1) %> Reviews: <%= @reviews.count %></p>
          <%# Insert a link_to "reviews_index" AJAX %>
        <% else %>
          <p>No reviews available.</p>
        <% end %>
      </div>

      <div class="profile-highlights">
        <div class="user-avatar">
          <% if @user.photo.attached? %>
            <%= image_tag @user.photo, class: "avatar-global avatar-profile" %>
          <% else %>
            <%= image_tag "meeple.png", class: "avatar-global avatar-profile" %>
          <% end %>
        </div>
        <div class="user-rating-stars">
          <% rating = @user.reviews.average(:rating) || 0 %>
          <% full_stars = rating.floor %>
          <% half_star = rating - full_stars %>
          <% total_stars = 5 %>
          <% empty_stars = 5 - full_stars - (half_star > 0 ? 1 : 0) %>

          <% full_stars.times do %>
            <i class="fa-solid fa-star" style="color: #ecb365;"></i>
          <% end %>
          <% if half_star > 0 %>
            <i class="fa-solid fa-star-half-stroke" style="color: #ecb365;"></i>
          <% end %>
          <% empty_stars.times do %>
            <i class="fa-regular fa-star"></i>
          <% end %>
        </div>
        <p><%= @user.description %></p>
      </div>

      <% if current_user != @user %>
          <%= link_to "Chat with #{@user.first_name}", user_chatroom_path(@user), class: "btn-main btn-chat", data: { turbo_method: :post } %>
      <% end %>

      <div class="profile-stats">
        <% stats_event_text = @user.events.count > 1 ? "games events" : "game event" %>
        <%= " Created #{@user.events.count} #{stats_event_text}" %>
        <br>
        <% accepted_bookings = @user.bookings.where(status: "accepted") %>
        <% stats_accepted_text =  accepted_bookings.count > 1 ? "games events" : "game event" %>
        <%= "Appeared in #{accepted_bookings.count} #{stats_accepted_text}" %>
          <br>
            <i class="fa-solid fa-circle-chevron-down"></i>
          <br>
        <% incoming_user_events = @user.events.where("end_hours > ?", Time.now).count %>
        <% @user == current_user ? stats_user_text = "You are" : stats_user_text = "#{ @user.first_name } is" %>
        <% stats_event_text = incoming_user_events > 1 ? "games events" : "game event" %>
        <%= "#{stats_user_text} hosting #{incoming_user_events} #{stats_event_text}" %>
      </div>

      <div class="profile-events-cards">
        <%# Insert events cards %>
      </div>
    </div>
  </div>
</div>
